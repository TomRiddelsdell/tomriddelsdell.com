name = "landing-page"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]
main = ".open-next/worker.js"

# CRITICAL: Assets directory for static files (CSS, JS, images)
# OpenNext Cloudflare places all static assets in .open-next/assets/
[assets]
directory = ".open-next/assets"
binding = "ASSETS"

# R2 binding for OpenNext incremental cache
[[r2_buckets]]
binding = "NEXT_INC_CACHE_R2_BUCKET"
bucket_name = "landing-page-cache"

# Preview environment (staging) - deployed from develop branch
[env.preview]
name = "landing-page-preview"
workers_dev = true  # Keep .workers.dev subdomain active

# Custom domain for staging (simpler than routes, automatically handles DNS/certs)
[[env.preview.routes]]
pattern = "staging.tomriddelsdell.com"
custom_domain = true

[[env.preview.r2_buckets]]
binding = "NEXT_INC_CACHE_R2_BUCKET"
bucket_name = "landing-page-cache"

# Staging environment secrets (injected via Doppler stg config)
# OTEL_EXPORTER_OTLP_ENDPOINT = Grafana Cloud OTLP endpoint
# OTEL_EXPORTER_OTLP_HEADERS = "Authorization=Basic <base64>"
# OTEL_SERVICE_NAME = "landing-page"
# OTEL_SERVICE_VERSION = "1.0.0"
# NEXT_PUBLIC_ENV = "staging"

# Production environment - deployed from main branch
[env.production] 
name = "landing-page-prod"
workers_dev = true  # Keep .workers.dev subdomain active

# Custom domains for production (automatically handles DNS/certs)
[[env.production.routes]]
pattern = "tomriddelsdell.com"
custom_domain = true

[[env.production.routes]]
pattern = "www.tomriddelsdell.com"
custom_domain = true

[[env.production.r2_buckets]]
binding = "NEXT_INC_CACHE_R2_BUCKET"
bucket_name = "landing-page-cache"

# Production environment secrets (injected via Doppler prd config)
# OTEL_EXPORTER_OTLP_ENDPOINT = Grafana Cloud OTLP endpoint
# OTEL_EXPORTER_OTLP_HEADERS = "Authorization=Basic <base64>"
# OTEL_SERVICE_NAME = "landing-page"
# OTEL_SERVICE_VERSION = "1.0.0"
# NEXT_PUBLIC_ENV = "production"

# Environment variables will be managed via Doppler
# No hardcoded secrets in this file